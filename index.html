<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clan Tactical Whiteboard</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --accent: #58a6ff; --text: #c9d1d9; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Controls */
        #sidebar { width: 280px; background: var(--panel); border-right: 1px solid #30363d; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .tool-group { border-bottom: 1px solid #30363d; padding-bottom: 15px; }
        h3 { margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; color: var(--accent); }
        
        select, button { width: 100%; padding: 10px; background: #0d1117; color: white; border: 1px solid #30363d; border-radius: 4px; cursor: pointer; }
        button:hover { border-color: var(--accent); }

        /* Draggable Icons */
        .icon-palette { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .drag-icon { width: 50px; height: 50px; background: #21262d; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: grab; border: 1px solid transparent; }
        .drag-icon:hover { border-color: var(--accent); }
        .drag-icon img { width: 30px; height: 30px; pointer-events: none; }

        /* Map Area */
        #canvas-container { flex: 1; position: relative; background: #010409; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        canvas { border: 2px solid #30363d; background-size: cover; cursor: crosshair; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        .floating-controls { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; }
        .btn-action { background: var(--accent); color: black; font-weight: bold; padding: 8px 15px; border-radius: 20px; border: none; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="tool-group">
        <h3>1. Select Map</h3>
        <select id="map-select" onchange="changeMap()">
            <option value="https://wiki.wargaming.net/en/Ship:Maps#/media/File:Land_of_Fire.jpg">Land of Fire</option>
            <option value="https://wiki.wargaming.net/en/Ship:Maps#/media/File:Sleeping_Giant.jpg">Sleeping Giant</option>
            <option value="https://wiki.wargaming.net/en/Ship:Maps#/media/File:Crash_Zone_Alpha.jpg">Crash Zone Alpha</option>
            <option value="https://wiki.wargaming.net/en/Ship:Maps#/media/File:North.jpg">North</option>
        </select>
    </div>

    <div class="tool-group">
        <h3>2. Deploy Fleet</h3>
        <small style="color:#8b949e">Drag icons onto the map:</small><br><br>
        <div class="icon-palette">
            <div class="drag-icon" draggable="true" ondragstart="drag(event, 'BB')"><img src="https://wiki.wgcdn.co/images/0/03/Ship_icon_Battleship.png"></div>
            <div class="drag-icon" draggable="true" ondragstart="drag(event, 'CA')"><img src="https://wiki.wgcdn.co/images/6/61/Ship_icon_Cruiser.png"></div>
            <div class="drag-icon" draggable="true" ondragstart="drag(event, 'DD')"><img src="https://wiki.wgcdn.co/images/4/4b/Ship_icon_Destroyer.png"></div>
            <div class="drag-icon" draggable="true" ondragstart="drag(event, 'Radar')"><img src="https://wiki.wgcdn.co/images/f/f0/Consumable_PCY020_RlsSearchPremium.png"></div>
            <div class="drag-icon" draggable="true" ondragstart="drag(event, 'Hydro')"><img src="https://wiki.wgcdn.co/images/a/a9/Consumable_PCY016_SonarSearchPremium.png"></div>
        </div>
    </div>

    <div class="tool-group">
        <h3>3. Drawing Tools</h3>
        <button onclick="setTool('draw')" id="btn-draw">‚úèÔ∏è Draw Path</button>
        <button onclick="setTool('move')" id="btn-move" style="margin-top:5px; background:#238636">‚úã Move Icons</button>
        <button onclick="clearCanvas()" style="margin-top:20px; color: #ff7b72">üóëÔ∏è Clear All</button>
    </div>
</div>

<div id="canvas-container" ondrop="drop(event)" ondragover="allowDrop(event)">
    <canvas id="mapCanvas" width="800" height="800"></canvas>
    <div class="floating-controls">
        <button class="btn-action" onclick="downloadMap()">Save Image</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('mapCanvas');
    const ctx = canvas.getContext('2d');
    let mapImage = new Image();
    let icons = []; // Stores placed icons: {x, y, type, img}
    let isDrawing = false;
    let currentTool = 'move';
    let draggedIconIdx = null;

    // Load initial map
    function changeMap() {
        // Note: Using placeholders since direct wiki links can sometimes CORS block
        // In a real app, you'd host these map JPGs locally.
        const url = document.getElementById('map-select').value;
        mapImage.src = 'https://wowsp-wows-na.wgcdn.co/dcont/fb/image/t_maps_01.jpg'; // Default placeholder
        mapImage.onload = draw;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
        
        // Draw Icons
        icons.forEach(icon => {
            const img = new Image();
            img.src = getIconUrl(icon.type);
            ctx.drawImage(img, icon.x - 20, icon.y - 20, 40, 40);
        });
    }

    function getIconUrl(type) {
        const urls = {
            'BB': 'https://wiki.wgcdn.co/images/0/03/Ship_icon_Battleship.png',
            'CA': 'https://wiki.wgcdn.co/images/6/61/Ship_icon_Cruiser.png',
            'DD': 'https://wiki.wgcdn.co/images/4/4b/Ship_icon_Destroyer.png',
            'Radar': 'https://wiki.wgcdn.co/images/f/f0/Consumable_PCY020_RlsSearchPremium.png',
            'Hydro': 'https://wiki.wgcdn.co/images/a/a9/Consumable_PCY016_SonarSearchPremium.png'
        };
        return urls[type];
    }

    // Drag and Drop logic
    function allowDrop(e) { e.preventDefault(); }
    function drag(e, type) { e.dataTransfer.setData("type", type); }
    
    function drop(e) {
        e.preventDefault();
        const type = e.dataTransfer.getData("type");
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        icons.push({ x, y, type });
        draw();
    }

    // Drawing lines logic
    canvas.onmousedown = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        if (currentTool === 'draw') {
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.strokeStyle = '#58a6ff';
            ctx.lineWidth = 3;
        } else {
            // Check if clicking an icon to move it
            draggedIconIdx = icons.findIndex(i => Math.hypot(i.x - x, i.y - y) < 20);
        }
    };

    canvas.onmousemove = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        if (isDrawing && currentTool === 'draw') {
            ctx.lineTo(x, y);
            ctx.stroke();
        } else if (draggedIconIdx !== null) {
            icons[draggedIconIdx].x = x;
            icons[draggedIconIdx].y = y;
            draw();
        }
    };

    canvas.onmouseup = () => {
        isDrawing = false;
        draggedIconIdx = null;
    };

    function setTool(tool) {
        currentTool = tool;
        document.getElementById('btn-draw').style.background = tool === 'draw' ? '#58a6ff' : '#0d1117';
        document.getElementById('btn-move').style.background = tool === 'move' ? '#238636' : '#0d1117';
    }

    function clearCanvas() {
        icons = [];
        draw();
    }

    function downloadMap() {
        const link = document.createElement('a');
        link.download = 'tactics-plan.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    changeMap();
</script>
</body>
</html>
